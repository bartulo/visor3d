<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - lines - fat</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<script src="js/jquery-2.1.4.js"></script> 
		
		<script src="js/bootstrap.min.js"></script>
		<script src="js/threejs/three.js"></script>
		<script src="js/threejs/controls/OrbitControls.js"></script>

		<script src="js/threejs/Detector.js"></script>
		<script src='js/threejs/TerrainLoader.js'></script> 

		<script src='js/lines/LineSegmentsGeometry.js'></script>
		<script src='js/lines/LineGeometry.js'></script>
		<script src='js/lines/WireframeGeometry2.js'></script>

		<script src='js/lines/LineMaterial.js'></script>

		<script src='js/lines/LineSegments2.js'></script>
		<script src='js/lines/Line2.js'></script>
		<script src='js/lines/Wireframe.js'></script>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css"> 
		<link rel="stylesheet" type="text/css" href="css/main.css"> 

	</head>

	<body>

		<div id="container">
				<ul class='tabs'>
					<li class='paint' id="paint">PINTAR</li>
					<li class='measure' id="measure">MEDIR</li>
				</ul>
				<div id="sidebar">
				<div class="tab_content">
				<div class="content__wrapper">
					<h2 class="text-color">Elige un color:</h2>
				
					<ul class="colors">
						<li data-color="#2ecc71"></li>
						<li data-color="#D64A4B"></li>
						<li data-color="#8e44ad"></li>
						<li class="active-color" data-color="#46a1de"></li>
						<li data-color="#bdc3c7"></li>
					</ul>
				</div>
				<div class="slide_wrapper">
					<input id="slide" type="range" min="4" max="20" step="1" value="8"/>
				</div>
				<div class="button_wrapper">
					<button type="button" class="btn btn-danger stop">Dejar de pintar</button>
				</div>

			</div>
			</div>
		</div>

		
		<script id="fragment_shh" type="x-shader/x-fragment">
			#ifdef GL_ES
			precision highp float;
			#endif

			uniform sampler2D tOne;
			uniform sampler2D tSec;

			varying vec2 vUv;
			
			void main(void)
			{
				vec3 c;
				vec4 Ca = texture2D(tOne, vUv);
				vec4 Cb = texture2D(tSec, vUv);
				c = Ca.rgb * Ca.a + Cb.rgb * Cb.a * (1.0 - Ca.a);
			    gl_FragColor= vec4(c, 1.0);
				
			}
			
		</script>
		<script id="vertex_shh" type="x-shader/x-vertex">
		
			varying vec2 vUv;
			
			void main()
			{
				vUv = uv;
				vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
				gl_Position = projectionMatrix * mvPosition;
			}
			
		</script>

		<script>
			

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var wireframe, renderer, scene, camera, controls;
			var plane, wireframe1, geometryLine, medir, pos;
			var renderStats;
			var gui;
			var positions = [];
			var colors = [];
			var lines = [];
			var a = 2;
			var count = 0;
			var colorButton = $(".colors li");
			var color = '#46a1de';
			var grosor = 4;

			// viewport

			init();
			animate();
			
			function hexToRgbA(hex){
			var c;
			if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){
				c= hex.substring(1).split('');
				if(c.length== 3){
					c= [c[0], c[0], c[1], c[1], c[2], c[2]];
				}
				c= '0x'+c.join('');
				return [((c>>16)&255)/255, ((c>>8)&255)/255, (c&255)/255];
			}
			throw new Error('Bad Hex');
			}
			
			function closeTab() {
				$('#sidebar')[0].style.marginLeft = '-310px'; 
				$('.tabs > li').css('left', '-10px');
				a = 2;
			}
				
			function openTab() {
				$('#sidebar')[0].style.marginLeft = '0px'; 
				$('.tabs > li').css('left', '300px');
			}
			
			$(".stop").on( "click", function() {
				closeTab();
			});
				
			
			$(".tabs > li").on( "click", function() {
				if ( a == 1 ) {

					if ( this.className == 'paint' ) {
						closeTab();
					} else if ( this.className == 'measure' ) {
						a = 3;
					} 

				} else if ( a == 3 ) {

					if ( this.className == 'paint' ) {
						a = 1;
					} else if ( this.className == 'measure' ) {
						closeTab();
					}
				} else if ( a == 2 ) {
					
					openTab();
					if (this.className == 'paint') {
						a = 1;
					} else if ( this.className == 'measure' ) {
						a = 3;
					}
				}});
				
			colorButton.on("click", function(){
		
				// Remove class from currently active button
				$(".colors > li").removeClass("active-color");
		
				// Add class active to clicked button
				$(this).addClass("active-color");
		
				// Get background color of clicked
				color = $(this).attr("data-color");
			});	
			
			$('#slide').on('change', function() {
				grosor = this.value;
			});

			function init() {

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setClearColor( 0x000000, 0.0 );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.getElementById('container').appendChild( renderer.domElement );

				scene = new THREE.Scene();

				camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.set( -40, 0, 200 );

				controls = new THREE.OrbitControls( camera, renderer.domElement );
				controls.minDistance = 10;
				controls.maxDistance = 500;
				
				//PLANO
				
				var terrainLoader = new THREE.TerrainLoader();
				terrainLoader.load('images/mdt.bin', function(data) {

					var vertShader = document.getElementById('vertex_shh').innerHTML;
					var fragShader = document.getElementById('fragment_shh').innerHTML;
			
					var uniforms = {    // custom uniforms (your textures)

					tOne: { type: "t", value: THREE.ImageUtils.loadTexture( '') },
					tSec: { type: "t", value: THREE.ImageUtils.loadTexture( 'images/pnoa.jpg' ) }
					};
					
					var material_shh = new THREE.ShaderMaterial({
						uniforms: uniforms,
						vertexShader: vertShader,
						fragmentShader: fragShader
					});
				
					var geometry = new THREE.PlaneGeometry(300, 300, 159, 159);
			
					for (var i = 0, l = geometry.vertices.length; i < l; i++) {
						geometry.vertices[i].z = data[i] / 65535 * 510;
					}
				
					plane = new THREE.Mesh(geometry, material_shh);
					scene.add(plane);
				});

				window.addEventListener( 'resize', onWindowResize, false );
				onWindowResize();

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );

				// main scene

				renderer.setViewport( 0, 0, window.innerWidth, window.innerHeight );

				renderer.render( scene, camera );


			}

		</script>

	</body>

</html>
